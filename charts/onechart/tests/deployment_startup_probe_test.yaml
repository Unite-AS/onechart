suite: test deployment
templates:
  - deployment.yaml
  - configmap.yaml
tests:
  - it: Should set a startup probe
    set:
      startupProbe:
        enabled: true
    asserts:
      - template: deployment.yaml
        documentIndex: 0
        equal:
          path: spec.template.spec.containers[0].startupProbe
          value:
            httpGet:
              path: "/"
              port: 80
              scheme: HTTP
            initialDelaySeconds: 0
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 3
            failureThreshold: 3
  - it: Should not set a startupProbe
    asserts:
      - template: deployment.yaml
        documentIndex: 0
        isNull:
          path: spec.template.spec.containers[0].startupProbe
  - it: Should tune startup probe
    set:
      startupProbe:
        enabled: true
        settings:
          periodSeconds: 30
    asserts:
      - template: deployment.yaml
        documentIndex: 0
        equal:
          path: spec.template.spec.containers[0].startupProbe
          value:
            httpGet:
              path: "/"
              port: 80
              scheme: HTTP
            initialDelaySeconds: 0
            periodSeconds: 30
            successThreshold: 1
            timeoutSeconds: 3
            failureThreshold: 3
